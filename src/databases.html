<!DOCTYPE html>
<html>
  <head>
    <title>mlproj - Databases</title>

    <!-- CSS stylesheets -->
    <link href="css/bootstrap.css"  rel="stylesheet" type="text/css" />
    <link href="css/clean-blog.css" rel="stylesheet" type="text/css" />

    <!-- fonts -->
    <link href="css/font-awesome.css" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css" />
  </head>
  <body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top" id="navbar">
      <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            Menu <i class="fa fa-bars"></i>
          </button>
          <a class="navbar-left" href="./" style="margin-top: 15px;">
            <img src="images/package-icon.png" style="height: 33px;" />
          </a>
        </div>
        <!-- the menu items -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="./">Introduction</a></li>
            <li><a href="start">Get started</a></li>
            <li><a href="commands">Commands</a></li>
            <li><a href="projects">Projects</a></li>
            <li><a href="environments">Environments</a></li>
            <li><a href="config">Config</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <article>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

            <h1>Databases</h1>
            <p>
              This page documents the database object structre, in the environment file
              format.  It contains the following sections:
            </p>
            <ul>
              <li><a href="#overall">Overall structure</a></li>
              <li><a href="#ranges">Range indexes</a></li>
              <li><a href="#searches">Searches</a></li>
              <li><a href="#lexicons">Lexicons</a></li>
            </ul>
            <p>
              For the definition of the overall environment file format, look at
              <a href="environments">that page</a>.
            </p>

            <a class="anchor" id="overall"></a>
            <h3>Overall structure</h3>
            <p>
              The property <code>databases</code> of an environment is an array of database
              objects.  Each database object looks like the following:
            </p>
            <pre>
{
    "id":   "...",
    "name": "...",
    "forests": [
        "..."
    ],
    "schema": {
        <em>(database object or ref)</em>
    },
    "security": {
        <em>(database object or ref)</em>
    },
    "triggers": {
        <em>(database object or ref)</em>
    },
    "indexes": {
        "ranges": [{
            "type":      "string",
            "name":      "ape",
            "positions": false,
            "invalid":   "ignore"
        }, {
            "type":      "string",
            "name":      [ "bear", "cat" ],
            "positions": false,
            "invalid":   "ignore"
        }]
    },
    "searches": {
        <em>(infos on searches)</em>
    },
    "lexicons": {
        "uri": false,
        "collection": true
    }
}</pre>
            <p></p>

            <h4>Name and ID</h4>
            <p>
              The <code>name</code> is the name of the database, the one used when creating
              it on MarkLogic.
            </p>
            <p>
              The <code>id</code> is a unique ID used only in the environment files, to
              refer to databases (e.g. from a server, to be its modules database).
            </p>

            <h4>Forests</h4>
            <p>
              The property <code>forests</code> defines the forests attached to the database.
              It can be a number of forests, or the explicit list of all forest names.
            </p>
            <p>
              If it is an array, it must be an array of strings.  Each is the name of a
              different forest to create and attach to the database.
            </p>
            <p>
              If it is a number (must be a positive integer then, including zero), it gives
              the number of forests to attach to the database.  The forest names are then
              derived from the database name, by appending <code>-001</code>,
              <code>-002</code>, etc.
            </p>

            <h4>Linked databases</h4>
            <p>
              A database has 3 linked databases (which can be self): a Schema database, a
              Security database and a Triggers database.  They are set using the following
              properties, resp.:
            </p>
            <ul>
               <li><code>schema</code></li>
               <li><code>security</code></li>
               <li><code>triggers</code></li>
            </ul>
            <p>
              Each can be either a full database object, or rather a reference to an existing
              database, by name or by ID.  See <a href="environments#databases">this section</a>
              for a definition of <em>database references</em>.
            </p>

            <a class="anchor" id="ranges"></a>
            <h3>Range indexes</h3>
            <p>
              Range indexes can be set in the property <code>indexes.ranges</code>.  It is
              an array of range objects.  All three types of range indexes are maintained
              in that same array (path range indexes, element range indexes and attribute
              range indexes).
            </p>

            <h4>Common properties</h4>
            <p>
              The following properties are common to all types of range index:
            </p>
            <ul>
              <li><code>type</code> - the scalar type of the range index
                (<code>int</code>, <code>string</code>...)</li>
              <li><code>positions</code> - a boolean, whether to save or not the range
                value positions</li>
              <li><code>invalid</code>: what to do in case of invalid values:
                <code>reject</code> or <code>ignore</code></li>
              <li><code>collation</code>: the collation to use for the range index</li>
            </ul>

            <h4>Path range</h4>
            <p>
              In addition, a path range index has the following property:
            </p>
            <ul>
              <li><code>path</code>: the path expression to use</li>
            </ul>
            <p>
              If the path is an array of strings, then the path range object corresponds
              to as many path range indexes, each with all the same properties, and with a
              different path from the array.
            </p>

            <h4>Element range</h4>
            <p>
              An element range index has the following properties, in addition to the common
              properties:
            </p>
            <ul>
              <li><code>name</code>: the local name of the element</li>
              <li><code>namespace</code>: the namespace URI of the element</li>
            </ul>
            <p>
              If the name is an array of strings, then the element range object corresponds
              to as many element range indexes, each with all the same properties, and with
              a different name from the array.
            </p>

            <h4>Attribute range</h4>
            <p>
              An attribute range index, in addition to the same properties as in an element
              range index, contains a <code>parent</code> property.  It is an object that
              identifies the parent element of the attribute.  It has two properties, a name
              and an optional namespace URI:
            </p>
            <ul>
              <li><code>parent.name</code>: the local name of the parent element of the
                attribute (only for attribute range indexes)</li>
              <li><code>parent.namespace</code>: the namespace URI of the parent element
                of the attribute (only for attribute range indexes)</li>
            </ul>
            <p>
              For instance, the following range object defines two attribute range indexes.
              Both of type <code>string</code>, on elements named <code>section</code> in
              no namespace, with no position recorded, and with invalid values ignored.
              One is for the attribute <code>id</code>, the second one is for the attribute
              <code>name</code>:
            </p>
            <pre>
"ranges": [{
   "type":      "string",
   "name":      [ "id", "name" ],
   "positions": false,
   "invalid":   "ignore",
   "parent":    {
      "name": "section"
   }
}]</pre>
            <p></p>

            <a class="anchor" id="searches"></a>
            <h3>Searches</h3>
            <p>
              The property <code>searches</code> is an object that contains information,
              options, and switches about searches.  For now it contains only the fast
              searches switches:
            </p>
            <pre>
"searches": {
    "fast": {
        "case-sensitive"            : true,
        "diacritic-sensitive"       : false,
        "element-character"         : false,
        "element-phrase"            : true,
        "element-trailing-wildcard" : true,
        "element-word"              : false,
        "phrase"                    : false,
        "reverse"                   : true
    }
}</pre>
            <p>
              Each property in <code>fast</code> corresponds to the property
              <code>fast-{name}-searches</code> in the Management API.  For instance,
              <code>case-sensitive</code> corresponds to
              <code>fast-case-sensitive-searches</code>.
            </p>
            <p></p>

            <a class="anchor" id="lexicons"></a>
            <h3>Lexicons</h3>
            <p>
              <code>lexicons.uri</code> and <code>lexicons.collection</code> set whether
              to maintain resp. a URI or a collection lexicon for that database.
            </p>
            <p></p>

          </div>
        </div>
      </div>
    </article>

    <!-- JS libraries -->
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.js"></script>
    <script src="js/clean-blog.js"></script>

  </body>
</html>
